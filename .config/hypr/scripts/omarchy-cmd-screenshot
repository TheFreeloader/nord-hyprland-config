#!/bin/bash

# Load user directories configuration
[[ -f ~/.config/user-dirs.dirs ]] && source ~/.config/user-dirs.dirs

# Set output directory with clear variable naming
# Priority: SCREENSHOT_DIR -> XDG_PICTURES_DIR -> $HOME/Pictures
OUTPUT_DIR="${SCREENSHOT_DIR:-${XDG_PICTURES_DIR:-$HOME/Pictures}}"

# Create the directory if it doesn't exist
if [[ ! -d "$OUTPUT_DIR" ]]; then
  mkdir -p "$OUTPUT_DIR"
  if [[ $? -eq 0 ]]; then
    notify-send "Created screenshot directory: $OUTPUT_DIR" -u normal -t 2000
  else
    notify-send "Failed to create screenshot directory: $OUTPUT_DIR" -u critical -t 3000
    exit 1
  fi
fi

# Take screenshot using hyprshot and process with satty
pkill slurp || hyprshot -m ${1:-region} --raw |
  satty --filename - \
    --output-filename "$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png" \
    --early-exit \
    --actions-on-enter save-to-clipboard \
    --save-after-copy \
    --copy-command 'wl-copy'
